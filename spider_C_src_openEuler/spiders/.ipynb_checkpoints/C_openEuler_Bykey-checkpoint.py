import scrapy
import pandas as pd
from ..items import SpiderCSrcOpeneulerItem
import random

class COpeneulerBykeySpider(scrapy.Spider):
    name = "C_openEuler_Bykey"
    allowed_domains = ["gitee.com"]
    #df = pd.read_csv('../openEulerRepo.csv')
    #urls = df.iloc[2:4]['repoLink'].tolist()
    #start_urls = [url+'/commits/master' for url in urls]
    agents_candidates = [
        "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 "
        "(KHTML, like Gecko) Chrome/22.0.1207.1 Safari/537.1",
        "Mozilla/5.0 (X11; CrOS i686 2268.111.0) AppleWebKit/536.11 "
        "(KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11",
        "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.6 "
        "(KHTML, like Gecko) Chrome/20.0.1092.0 Safari/536.6",
        "Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.6 "
        "(KHTML, like Gecko) Chrome/20.0.1090.0 Safari/536.6",
        "Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.1 "
        "(KHTML, like Gecko) Chrome/19.77.34.5 Safari/537.1",
        "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/536.5 "
        "(KHTML, like Gecko) Chrome/19.0.1084.9 Safari/536.5",
        "Mozilla/5.0 (Windows NT 6.0) AppleWebKit/536.5 "
        "(KHTML, like Gecko) Chrome/19.0.1084.36 Safari/536.5",
        "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3",
        "Mozilla/5.0 (Windows NT 5.1) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3",
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_0) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3",
        "Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3",
        "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3",
        "Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3",
        "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3",
        "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3",
        "Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 "
        "(KHTML, like Gecko) Chrome/19.0.1061.0 Safari/536.3",
        "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.24 "
        "(KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24",
        "Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/535.24 "
        "(KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24"
    ]
    headers = {
        'Referer': 'https://gitee.com/',
        #'User-Agent': random.choice(agents_candidates),
        'Host': 'gitee.com'
    }

    repo_commit_urls = ['https://gitee.com/src-openeuler/deepin-wallpapers', 'https://gitee.com/src-openeuler/babl', 'https://gitee.com/src-openeuler/openjpeg2']
    #start_urls = [url + '/commits/master' for url in repo_commit_urls]
    #start_urls = ["https://gitee.com/src-openeuler/docker/commits/master"]
    filter_keywords = ['cve-', 'cwe-', 'vulne', '空指针', 'overflow', 'injection', 'security bug', 'security', '安全', '溢出',"memory corruption", "memory","execution of arbitrary code", "write-what-where conditions", "Fix BOF", 'BOF Bug', 'BOF','divide by zero', 'divide-by-zero', 'division-by-zero', 'div-by-zero', 'division by 0', 'divide by 0', 'zero divisor', '除零', '除0']  # 新增cwe-369

    cookies_me = 'user_locale=zh-CN; oschina_new_user=false; tz=Asia%2FShanghai; sensorsdata2015jssdkchannel=%7B%22prop%22%3A%7B%22_sa_channel_landing_url%22%3A%22%22%7D%7D; feature_log_id=10; slide_id=10; Serve_State=true; Hm_lvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1695870318; Hm_lvt_a708ba73ea8e3c9b858080e1f0ae9584=1696648159; Hm_lpvt_a708ba73ea8e3c9b858080e1f0ae9584=1696666562; BEC=1f1759df3ccd099821dcf0da6feb0357; Hm_lvt_24f17767262929947cc3631f99bfd274=1695094403,1696902442; yp_riddler_id=fa413286-288d-4d41-a6b3-2d0eb585ba1a; remote_way=ssh; Hm_lpvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1697008843; user_return_to_0=%2F; csrf_token=5EkIKagpyrulafNxo2e2pgrsgEYhQgWN3zXEL%2Bn3r6A28Rf7HaPhPqvcWv83NWgpOizIfyAM0J4flrmz5P767w%3D%3D; Hm_lpvt_24f17767262929947cc3631f99bfd274=1697013846; gitee_user=true; gitee-session-n=OHR2ejcwYVZvdG1xeHlQWXB6dkF4dFBYd2ZaZDI2UHVhbzloWWYxam1rS1RDWklJQ1hJeTUyZzBlTHRVNkRGQWZhb0twZFlZQWJ2YW9ua0xFZG43T2dHdDBPb1VNYStXNUJaQjRmcWtBVlFjaTBta0pkcFRBaWVVNThyL0l1S2ZKdUVvRE1nc3N2MFJYUDlmT1JyT0VhSkIrc2Exc2xTcEc0QTE4azNFd1Y1VC9GT0luN00yTjQ4Y3p4em1CY2F1M3k5dVpyK3VFUG91ZXVod01XY1lGdXlxSy9xKzNCclZkc1JVbjc3azg0d2RKazdkblJ6SXY5bG9heldRUS80NllQTkh6MlllS20wcjhGQzhZUXYwNzJ5akJtWjI5bno4YTJUQXFSeWhXVW1xTzV6ZW5QZVRTUkJ2cDVhVlIwOU92d1dPeE42SFhWQVo5MDV5Z0Q3RjJPVkVZcjdzNjR4bzVGZkFJWDdVbnR4TG90RmhVcmpXN2FSS1creEdBbjlrMHJVRFBFNGNVZzEydFJQMGNpbHVyOHFFVzJpV09mcW1DMjRuZGtVK2Naa0F4SzF1Ry9XTnZWUFd1b3FjY0VZbjYrOGJhTmFEV2x6VWpJVmxWdVV6bTZkcVRlbVRsUGlVVGxENXAxQTExVmdwd3NmeCtnNDBSMlFFYlRxY08vNUhuVmREK1VoMjdnQzhNa2k2WlBJci9KQXZuellhcUFkSzhQam1Eeng3L2VWdFkzQXNNUEJ2a2ZSbUpUQmFreW5HMTk3dXZrVmpLbk1icmptZDJXa1dnR2pZZytwZkNoMjdiOFZvQTllVEp0Tm5qMDNEVlVJNmFCYU1JRThHeGprT2xPbkNITnBRcTd3WEo2L0syVk1POUUxWDlXbXNvV0RteW94cmZXc1FUd0E9LS1iOEZJSFFLTjJZK1ZLcFNuNkw1UUhBPT0%3D--740f925da445da6ebe41498c298010cfdaad8388; sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%2218b1de8506c958-0857ea16558b458-26031e51-2073600-18b1de8506d3121%22%2C%22first_id%22%3A%22%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22%E7%9B%B4%E6%8E%A5%E6%B5%81%E9%87%8F%22%2C%22%24latest_search_keyword%22%3A%22%E6%9C%AA%E5%8F%96%E5%88%B0%E5%80%BC_%E7%9B%B4%E6%8E%A5%E6%89%93%E5%BC%80%22%2C%22%24latest_referrer%22%3A%22%22%7D%2C%22identities%22%3A%22eyIkaWRlbnRpdHlfY29va2llX2lkIjoiMThiMTc0NDZjMjdiMTktMDBhYzVhMmRlZWI4ZmU4OC0yNjAzMWU1MS0yMDczNjAwLTE4YjE3NDQ2YzI4MWExMCJ9%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%22%2C%22value%22%3A%22%22%7D%2C%22%24device_id%22%3A%2218b17446c27b19-00ac5a2deeb8fe88-26031e51-2073600-18b17446c281a10%22%7D'
    cookies_wu = 'user_locale=zh-CN; oschina_new_user=false; tz=Asia%2FShanghai; sensorsdata2015jssdkchannel=%7B%22prop%22%3A%7B%22_sa_channel_landing_url%22%3A%22%22%7D%7D; feature_log_id=10; slide_id=10; Serve_State=true; Hm_lvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1695870318; Hm_lvt_a708ba73ea8e3c9b858080e1f0ae9584=1696648159; Hm_lpvt_a708ba73ea8e3c9b858080e1f0ae9584=1696666562; BEC=1f1759df3ccd099821dcf0da6feb0357; Hm_lvt_24f17767262929947cc3631f99bfd274=1695094403,1696902442; yp_riddler_id=fa413286-288d-4d41-a6b3-2d0eb585ba1a; remote_way=ssh; Hm_lpvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1697020068; sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%2218b1e4f6b9aa2f-02e9a5f606e202a-26031e51-2073600-18b1e4f6b9b306a%22%2C%22first_id%22%3A%22%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22%E8%87%AA%E7%84%B6%E6%90%9C%E7%B4%A2%E6%B5%81%E9%87%8F%22%2C%22%24latest_search_keyword%22%3A%22%E6%9C%AA%E5%8F%96%E5%88%B0%E5%80%BC%22%2C%22%24latest_referrer%22%3A%22https%3A%2F%2Fwww.google.com%2F%22%7D%2C%22identities%22%3A%22eyIkaWRlbnRpdHlfY29va2llX2lkIjoiMThiMTc0NDZjMjdiMTktMDBhYzVhMmRlZWI4ZmU4OC0yNjAzMWU1MS0yMDczNjAwLTE4YjE3NDQ2YzI4MWExMCJ9%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%22%2C%22value%22%3A%22%22%7D%2C%22%24device_id%22%3A%2218b17446c27b19-00ac5a2deeb8fe88-26031e51-2073600-18b17446c281a10%22%7D; csrf_token=SaZv9jZUn%2F0CYXQud8qw%2BtbMklPek%2Bg2qBLm%2BtBD0L5AfwRnIU%2FlfsJ%2FbIqNGmI%2BiueX8uEJtGuZa%2FTm0jt5Mw%3D%3D; user_return_to_0=%2F; Hm_lpvt_24f17767262929947cc3631f99bfd274=1697020725; gitee_user=true; gitee-session-n=R0RRT1NuakY5RjNUZHplZVlKV2pIVXNPcFlNOWt2cFFpcThhNXVSeDVYSlkyOU56YlN3ZHZoK0FCOXVxNzRJRS9CVlRzUnRNamxTYjkvNzdVL2JnUjhjcGFXRkttWmNYMnhST1JVNlE5V2tmNzRxTmF0V0NnRFFDSlVscE9pNVIrNXI1ejNxa2EyYnJFY1IvTUZKNUt0SEJuTTc1bUFBOHNyWmVML3lTMFd6aUlUd2IzcVUzYk96cTVqNEh4NkJPSVhKNTNYTWx0Qkd4M0hZbXhRSXlJaXUrVnZOU01KRmV3ZVJuMlhGWFBiMkoyR2Z6a01LRnVtVVNOblZkM1FTblVTVlBlY1pwcFE1U1Zud0F4K1hzYVRiWERWM21mVS9tYlJYWTNFTUJBNUFHOHExcXlpVW1pUEVmNTV3THNxR2hndVlCZ3E2TERkWHZkRGFSMDl6blg0NWt5cG1kdWppdmJMR1VrZmVNUWNXaWVHeU9UMEdwUk83MWRNT09ZcVJFOWRJaUNsYk9URCtFc2plclQzSk9pVE5iV1pkazlCclVkaTdPUFVrcUpmZjVUT3NKbEM5OTZvNnV3RncrdFlaT3lJOTJJUExtdGg1eW0wbmo5ZjhVNUhoSWN0V0VTNURPYndjV1FSVE5jcTlVb0I5Rkc2V21wUWZub1hhck0vTlAzZzNkZ29mZTlLN1ZrK05rYXAwcU9GdFo0OHhkQ3FOcWlsbThZWWozd2pvN1ZYK0h2Vnk4WE4vWkhKTHpaRlZUMmUrdXhnWlFvcnVWdTBvOXlUdjlVTmRjWHRQdmV0c0FLUzJhem9NL3FWWXlTWnlhbW5EWVVyWFhqTDNHSytvdmFpU2EvemZRTDJUSjMwNml4R1FNVjlhbkFjMFlYcTJYUWVmUkhiM0RpbXM9LS13TkxtNWRVSUluUGIrVEx0SWczOTlBPT0%3D--7071b13c6f64f1f8a58d3e64d443bbcd5ee38f24'
    cookies_guo = 'user_locale=zh-CN; oschina_new_user=false; tz=Asia%2FShanghai; sensorsdata2015jssdkchannel=%7B%22prop%22%3A%7B%22_sa_channel_landing_url%22%3A%22%22%7D%7D; feature_log_id=10; slide_id=10; Serve_State=true; Hm_lvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1695870318; Hm_lvt_a708ba73ea8e3c9b858080e1f0ae9584=1696648159; Hm_lpvt_a708ba73ea8e3c9b858080e1f0ae9584=1696666562; BEC=1f1759df3ccd099821dcf0da6feb0357; Hm_lvt_24f17767262929947cc3631f99bfd274=1695094403,1696902442; yp_riddler_id=fa413286-288d-4d41-a6b3-2d0eb585ba1a; remote_way=ssh; Hm_lpvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1697020068; sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%2218b1e4f6b9aa2f-02e9a5f606e202a-26031e51-2073600-18b1e4f6b9b306a%22%2C%22first_id%22%3A%22%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22%E8%87%AA%E7%84%B6%E6%90%9C%E7%B4%A2%E6%B5%81%E9%87%8F%22%2C%22%24latest_search_keyword%22%3A%22%E6%9C%AA%E5%8F%96%E5%88%B0%E5%80%BC%22%2C%22%24latest_referrer%22%3A%22https%3A%2F%2Fwww.google.com%2F%22%7D%2C%22identities%22%3A%22eyIkaWRlbnRpdHlfY29va2llX2lkIjoiMThiMTc0NDZjMjdiMTktMDBhYzVhMmRlZWI4ZmU4OC0yNjAzMWU1MS0yMDczNjAwLTE4YjE3NDQ2YzI4MWExMCJ9%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%22%2C%22value%22%3A%22%22%7D%2C%22%24device_id%22%3A%2218b17446c27b19-00ac5a2deeb8fe88-26031e51-2073600-18b17446c281a10%22%7D; csrf_token=q6b1Fjsp4djrOGnMUpAZp8lcTMOVLge2x4KtQDN%2Bmk6xrH1Y3zj6nHILi99BPN7SQ%2BNEoBeXZKFnNB0p%2BqovIA%3D%3D; Hm_lpvt_24f17767262929947cc3631f99bfd274=1697021096; gitee-session-n=VG51bmJveXRhUnVmdXpGeVlMbEoxNDVoL0FFM2R6eW93NUg5ZDNBK3RsNzFheEwzeEd6MkxCdGhZYVcvc0pDS3IrV0hrMVZhSjV2RHBFeVVDM3pNOGUwMXVabHJ5SUxaUXpoUkF4VjdadmZLdEZyWjNmN3k2TVc4OFo2bmt2dzlHSXFrMUNzZ2NWVGZiM052NGpmYkhFWUswRWxWajlteDVnbUNSVlB2SFFpVE1VcnprakVxQ3pBcER2R2d3VlNLVG9nMmJFTVA0bXd0U0tSOE84MEgzSzluZGtBR3RKNmhMWFlZTHdjcmltbzdiTDhYZHhxOGJGU0JnenZqZEhSMmptRmk2WFZWM05mRHpHM1NzQ2xvZVhVTWJ0TmNWVldHTE5IN0lLNitBdUJ5WDdWRWNkVVdnNzBNSVFBa0xXTHBJUGoyY1krWUZmQUNJazh0QVdTV2VhTFd4b1ZidUdxZTBZTmRTTDhLalBDMUpQOUJVTmh1RmN1eWpoUWFDdFJXM3VVY2lQbStZa3FQQ1JjWXozS2RiWEVWWmJ5UWM3QVZ6Zm04NTFUN2UrRmVDZXBZOGhSMVY4M2N4TUQxTE9rUjhDR0MxOElIRmxtbGhrenVqRlNKenYvSmpPa3laa3EvOEhwYlR2Zm16NjA1NnFTWjU5TDNqdXRlWjIva21hT2s4NldVbUFJSkdCNzVmWDAzWVhpRCtib3ZOU2I4YzFZdlZpb1ZCR1djS29kNFNLakt0NFpJb1lGQjZYa0N0dTc1K2ZqVTh3NWdadldvWHM4N3ovdFdrTzlDTUovYVV5V0ZVV3BkMzBaMWovWWF3SDRoc2NiTUZXdk92elcvMFo3a21hNmdFZnk0b0FndUFZZGNGZWxyNGx2b29YSEc3M1kwalVpUUZmUGc3MGs3UUxtcW1FOWh2UzFpUEZlZHYxeXNpUHV0dExQaHFsT2xpY2VSb3RwcFVOTy9wYkFobDZvMFBteEVzT1A0RVdVWDNqS1oxempsSDBkc1BFUHY3ZFU1UFNZSS9YRnpMSVZLRXJEVEZVaDNPcU5wWmhPQ3A4L0FQTzJacTg4WmhkMlZqNUUvYzFZcHRsUEZ0L3JFKy9aTHVvTy9rcU1WcEtOcFFtTGkrcXQ5UUxkM3JyTE15azRHOW1FdnU5NlBTYlBuc1BNNXFmWWoxWHA0SzZxQzdmSERTbElab0dBYVU4aldRd3dIakdwOG5xc1JHUlNpU1FETHdmUkZ4WlZXMm5VPS0tVUxUaU9oNlVGSjcrMndJNHVvRXlpUT09--3b92eefdc87843cf892432b8bd3d92c99beb3401'
    cookies_yu = 'oschina_new_user=false; sensorsdata2015jssdkchannel=%7B%22prop%22%3A%7B%22_sa_channel_landing_url%22%3A%22%22%7D%7D; feature_log_id=10; slide_id=10; Serve_State=true; Hm_lvt_a708ba73ea8e3c9b858080e1f0ae9584=1696648159; yp_riddler_id=fa413286-288d-4d41-a6b3-2d0eb585ba1a; remote_way=ssh; BEC=1f1759df3ccd099821dcf0da6feb0357; user_locale=zh-CN; Hm_lvt_24f17767262929947cc3631f99bfd274=1695094403,1696902442,1697072252; tz=Asia%2FShanghai; Hm_lvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1695870318,1697074066; Hm_lpvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1697160080; csrf_token=KrV8sHud6sTur7V1B%2FHjjD5BSxOdVC6vooIraq4hnbvmFChSCceboTVsoycMIsIiOX4BGBZSRAdI7nkFPsu6qw%3D%3D; user_return_to_0=%2F; Hm_lpvt_24f17767262929947cc3631f99bfd274=1697163494; gitee_user=true; gitee-session-n=SlFHbTh4TFc5cVFSanpiaUwzdHVLdTl3b2hDM2cxYy9zQUpwdTNZdEdaSUlVb1p5TS9YdHJ1TUQ5dDdTcURQYWVaTDNnYkRNeENoSTdCUXFMT2J4Ky9LcTh3VXkxcFBYb2lxRzAvSDVGTWZRRTlDWFhTZGxNUXFBRytDR29qQ3NENWYxaVB2bmh5WVdZZFVNSmxsbXZoMUZ3N2YyaUN1L29mYy9JN2xvSFhncDV5YnBXVnNwWlNGcjAxRXpMNTRETURXdGE0eUhzNnNKckJ1K29xWGp6cUFrRkZCU25YaXFBeEFaTUZ2azBXSWJ6QjdsekFzbS9IZEhFRUI4N0NUdGp6N0dwL2NoUk5ROVo4aHM1MHcvS2Rhd2Y0dzdBSU9OeFRKSjBYc3k1L2wySGZqKy9JQzhJSjJJSDVnQURMNm5PdEZkWjVhUXlBMkp2QmYxVUVYZ1lLUTE5VVhzeGRGbDgvUGFrZHY3TjFOWlc1eFA3cTFLclNXRGpFcHVtN2krdm5BR3pLc25xbjlXTENIOGRTTmdObVJ1K21HYWJobjFLUGo4ZzZncStUd3lmNk5pZkZOSjgzZFJSajdnVkw1cVZSekNNR255QkRqQlNWREd5MUM5cHZURXVxcitNNWNPbGd1TnYzQ0ZzWXlwdU9nSEprRjh2c0owemZUSnhVd2dMcGFDZ3lzM2xLZzdiTlkvVTNIVWtWbnJZT2c3cEZXc2N3NEZWeUJ5RU14enFlOVdOWHNMNHZBL2hGZ3RZYXZaejV3TkJrVy9SaHZMM0E0R0ZvTW9KNXdQbHpEd0hoK2t6cTBXZHVCelpGbWdUVnZyeC9KR3p2eFhRbCtvakxiK1lMR3RwV0dZT1RtbVdPbGVDL1pWNjUxS1RYVnUvOVhTRUFodG5tR2l3c3M9LS1KUEFmbVdqRDZQSHh3UVJ6aUFleFBRPT0%3D--504fbfaf23abb41c58b60af752bbdbb0b39a839f; sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%2218b26d3c24119f9-035975a3fe9868-26031e51-2073600-18b26d3c242667%22%2C%22first_id%22%3A%22%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22%E7%9B%B4%E6%8E%A5%E6%B5%81%E9%87%8F%22%2C%22%24latest_search_keyword%22%3A%22%E6%9C%AA%E5%8F%96%E5%88%B0%E5%80%BC_%E7%9B%B4%E6%8E%A5%E6%89%93%E5%BC%80%22%2C%22%24latest_referrer%22%3A%22%22%2C%22%24latest_utm_source%22%3A%22gitee_search%22%7D%2C%22identities%22%3A%22eyIkaWRlbnRpdHlfY29va2llX2lkIjoiMThiMTc0NDZjMjdiMTktMDBhYzVhMmRlZWI4ZmU4OC0yNjAzMWU1MS0yMDczNjAwLTE4YjE3NDQ2YzI4MWExMCJ9%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%22%2C%22value%22%3A%22%22%7D%2C%22%24device_id%22%3A%2218b17446c27b19-00ac5a2deeb8fe88-26031e51-2073600-18b17446c281a10%22%7D'
    cookies_jie = 'oschina_new_user=false; sensorsdata2015jssdkchannel=%7B%22prop%22%3A%7B%22_sa_channel_landing_url%22%3A%22%22%7D%7D; feature_log_id=10; slide_id=10; Serve_State=true; Hm_lvt_a708ba73ea8e3c9b858080e1f0ae9584=1696648159; yp_riddler_id=fa413286-288d-4d41-a6b3-2d0eb585ba1a; remote_way=ssh; BEC=1f1759df3ccd099821dcf0da6feb0357; user_locale=zh-CN; Hm_lvt_24f17767262929947cc3631f99bfd274=1695094403,1696902442,1697072252; tz=Asia%2FShanghai; Hm_lvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1695870318,1697074066; Hm_lpvt_6bc840df1e0b2cbbd5d0aab3e06b2610=1697097223; csrf_token=3Q5scWvcJyM5y71PR%2B0bJiAhaAzA6ZK01iGalVzyRyGsgr6dlR7L9ImXoPrtS6WaLOdOot3O%2F%2FcUOV5e1%2FP9Dg%3D%3D; Hm_lpvt_24f17767262929947cc3631f99bfd274=1697097277; gitee-session-n=TzB3L0VzVUhTc3h2WjlYQnVLTENsbE1uVWFBWmlRcHNpTmJMdUs2L1RJUG9sMnV6azJtd0dxeGU4QldvS0UrOThzOTAzcG5XK1hTRFhtaWtZNnQ3NzYrZWk4K1hHbTd3UWM2K1QzV1ZwcDFRQ0paR1laMEFiVDl2eFJMTEUrbTBIU1NzQkxaMXZXS3ZLcXZtajVjK3EyK1AxVHpxUEFzcDJhZU9vNlVxZXdpbWRKZmpaNmtoa3VUR3RmNzN2TFpKaE5Bc3ROT0tZY01QV0tZVkNjQ1VDalRSeGhCSnEvcXU1THRHd2VnTmViSjQ0aUpQT0pIVWlzYks1RkJQZTh2TDArOVZDYlJkYzVVSGhVcm9PQ29mT3IwUHVENWdha0lhcDdCOXpMYngwcG9qVGtQZnNVaTlhZTE3WEY2NFRNL055dzQ4NnZGbitBSGRqS29iYkVGei9NdTgyTktEbTE1d1B5NHR0aktBOXdXSEl1WDZvWVJ5aEthN0plZmc4TU56d2dZeTR6TFdyMEFlb1B5UEprK1UzenZlQ1p6dUtKeEl5OEc2TkppOWdWcm4yTmlqaXNaYkViZVdWMGZCYkJxVlJBS3pwcUh5ODRCUUdnemtwWjVMc3YrUVR2U1ZPKy9YdGh3dlFIcWFxWWRIOW0ycStRak0yTGZqM3M5U1ZSOHVIdzh3cG9HVWxwTG1IK08vUXVsSmowcWtkV2RZdGdsT1YzOEdVd3p2K3BxWGN4RGU2NGZxelFBdkkxSlFqa25odVJEampvem9wVEdDaFkvUGEwVUphVTU0ZERLbW1nRGhvaFVNamJDZEJrMVlCUWROc1pkb3VDbUVGeEh2b0RUcnpLTVkwVkF4am9Ea25rdVp5RndPT0xkUmE1akx1aGIxbjZtUUtwWGQxWm96OEZrVm5TK3dma2dQMXZMSmJWNzI3bzVBeVFQSW5Wc3N3dG45MzdXNkxEdDg0TXNHTzk5RjBNaFVLbWo5dUF6eERxaWQ0WHprMVlueC9rVTFhaW41enEzT1ZnNmt3ZTJNU2hjdDVpTnE3MFhkdTN6Q0krTUlDb0c0NjI5c2Vrd0NEcmt1Vm0xemUySk1JR2dKSy9wM0psZW83YktmdWpFajNRODlKWTRNS1VBVU5kY0t1QXJhN21xWHFyWmV1QjVIcW9VVWRWV1NzVVZwTXBJMUhGRWJVVWJDV3dRcXVPbkhPem1Zai9xVlVsUzV4ODlWMUd1TXh0SndVeDVIemJRPS0teEFXbHJJbHlJT1U2QklBRzRxRHBZZz09--de3c74a883ef8c0843b93bb591596d205eb83f2e; sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%2218b22e15e992873-0cf6ec1fbed2d7-26031e51-2073600-18b22e15e9a2fc4%22%2C%22first_id%22%3A%22%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22%E7%9B%B4%E6%8E%A5%E6%B5%81%E9%87%8F%22%2C%22%24latest_search_keyword%22%3A%22%E6%9C%AA%E5%8F%96%E5%88%B0%E5%80%BC_%E7%9B%B4%E6%8E%A5%E6%89%93%E5%BC%80%22%2C%22%24latest_referrer%22%3A%22%22%7D%2C%22identities%22%3A%22eyIkaWRlbnRpdHlfY29va2llX2lkIjoiMThiMTc0NDZjMjdiMTktMDBhYzVhMmRlZWI4ZmU4OC0yNjAzMWU1MS0yMDczNjAwLTE4YjE3NDQ2YzI4MWExMCJ9%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%22%2C%22value%22%3A%22%22%7D%2C%22%24device_id%22%3A%2218b17446c27b19-00ac5a2deeb8fe88-26031e51-2073600-18b17446c281a10%22%7D'
    cookie_candidate = [{i.split("=")[0]: i.split("=")[1] for i in cook.split(";")} for cook in [cookies_yu, cookies_jie, cookies_wu, cookies_guo, cookies_me]]  #

    def __init__(self, start_url):

        self.start_url = start_url

    def start_requests(self):
        # 每次随机选一个user-agent跟我们5个人的cookies

        yield scrapy.Request(url=self.start_url, cookies=random.choice(self.cookie_candidate), headers=self.headers)


    def parse(self, response):
        #print("这次的URL  ", response.url)
        commit_block = response.css('.commit-group .commit-content')
        item = SpiderCSrcOpeneulerItem()
        for block in commit_block:
            commit_texts = block.css('.commit-row-title a::text').extract()
            commit_urls = block.css('.commit-row-title a::attr("href")').extract()
            if commit_texts and commit_urls:
                commit_text = commit_texts[-1]
                commit_url = commit_urls[-1]
                for keyword in self.filter_keywords:
                    if keyword.lower() in commit_text.lower():
                        print("--------", commit_text, commit_url)
                        item['commit_msg'] = commit_text
                        item['commit_url'] = commit_url
                        yield item
        icon = response.css('.tiny.pagination.menu .icon.item::attr("href")').extract()
        #print(icon)
        if icon:
            if "page=" in icon[-1]:
                yield scrapy.Request(url="https://gitee.com"+icon[-1], cookies=random.choice(self.cookie_candidate), callback=self.parse)




